# TP Fractale

## Présentation

Une figure fractale est un objet mathématique qui présente une structure similaire à toutes les échelles. En zoomant sur une partie de la figure, il est possible de retrouver toute la figure, on dit alors qu’elle est « autosimilaire ». Plusieurs autres conditions que l'autosimilarité permettent de catégoriser une fractale. Cependant, les figures fractales n'ont pas à satisfaire toutes ces propriétés pour servir de modèles. Il leur suffit de réaliser des approximations convenables quant aux règles établies. On retrouve des exemples de formes fractales dans la nature comme le choux romanesco.

![image](./assets/08/fractal_mandelbrot.jpg)

En zoomant à l'infini, on retrouve des formes similaires.

![gif](./assets/08/gif_fractal.gif)

Durant ce TP nous allons utiliser la bibliothèque `Turtle` afin de pouvoir dessiner.

![gif](./assets/08/gif_turtle.gif)

Turtle est une bibliothèque permettant de créer des GUI, c'est-à-dire des interfaces graphiques. Avec turtle, nous allons pouvoir créer une fenêtre et dessiner dedans à l'aide de suite d'instruction.

Quelques fonctions utiles:

```python
from turtle import Screen, Turtle

# cree une fenetre
screen = Screen()
# regle la taille de la fenetre
screen.setup(width, height)
# lance la fenetre
screen.mainloop()

# cree une turtle permettant de dessiner
turtle = Turtle()
# cache le pointeur en forme de tortue
turtle.hideturtle()
# regle la vitesse de dessin
turtle.speed(speed)

# met à jour la couleur du crayon (tortue)
turtle.color("red")
# met à jour la largeur du trait
turtle.width(branch_width)

# change la direction du crayon par une rotation vers la droite
turtle.right(angle)
# change la direction du crayon par une rotation vers la gauche
turtle.left(angle)
# avance le crayon pour tracer un trait d'une certaine distance
turtle.forward(distance)
# recule le crayon pour tracer un trait d'une certaine distance
turtle.backward(distance)
```

### Exemple

```python
turtle.forward(100)
turtle.left(20)
turtle.forward(100)
```

Ce code produit ce dessin: \
![image](./assets/08/example_turtle.png)

- Dessiner un trait de 100 vers l'avant
- Faire une rotation de 20° vers la gauche
- Dessiner un trait de 100 vers l'avant

Pour réaliser ce TP:

- On va créer un environnement conda appelé `fractal`. On y installera python, pip et turtle en deux commandes. Puis on utilisera cet environnement dans VSCode.

  ```bash
  conda install python pip
  pip install PythonTurtle
  ```

- Ce projet doit être créé dans un projet Git.

- La fonction `main` doit être utilisée.

## Exercice 1.1

Créer une fonction `initialize_screen` qui initialise une fenêtre turtle avec une taille et lancer la fenêtre dans le code.

## Solution 1.1

```python
from turtle import Screen, Turtle


def initialize_screen(width, height):
    screen = Screen()
    screen.setup(width=width, height=height)

    return screen


def main():
    screen = initialize_screen(width=1.0, height=1.0)

    screen.mainloop()


if __name__ == "__main__":
    main()
```

## Exercice 1.2

Ajouter au code existant une fonction `initialize_turtle` qui initialise une crayon turtle, cache le pointeur et règle la vitesse de dessin.

## Solution 1.2

```python
from turtle import Screen, Turtle


def initialize_screen(width, height):
    screen = Screen()
    screen.setup(width=width, height=height)

    return screen


def initialize_turtle(speed):
    turtle = Turtle()
    turtle.hideturtle()
    turtle.speed(speed)

    return turtle


def main():
    screen = initialize_screen(width=1.0, height=1.0)
    turtle = initialize_turtle(speed=0)

    screen.mainloop()


if __name__ == "__main__":
    main()
```

## Exercice 1.3

On va maintenant s'intéresser à dessiner la `canopée fractale`.

![image](./assets/08/fractal_canopy.png)

Une canopée fractale est créée en divisant un segment de ligne en deux segments plus petits à ses extrémités, puis en divisant également les deux segments plus petits, et ainsi de suite, à l'infini.

Une canopée fractale a les trois propriétés suivantes:

- L'angle entre deux segments de ligne voisins est le même dans toute la fractale.
- Le rapport des longueurs de deux segments de ligne consécutifs est constant.
- La figure entière est un graphe, c'est-à-dire que chaque branche est connectée à la branche de son niveau précédant.

Écrire la fonction suivante permettant le dessin de la canopée fractale.

```python
def fractal_canopy(turtle, branch_length, branch_width, ratio, depth, angle):
    ...
```

### Conseil

C'est une fonction récursive.

## Solution 1.3

```python
from turtle import Screen, Turtle


def initialize_screen(width, height):
    screen = Screen()
    screen.setup(width=width, height=height)

    return screen


def initialize_turtle(speed):
    turtle = Turtle()
    turtle.hideturtle()
    turtle.speed(speed)

    return turtle


def fractal_canopy(turtle, branch_length, branch_width, ratio, depth, angle):
    # condition d'arret de la récursion, lorsque l'on atteint une "feuille d'arbre"
    # si il n'y a plus de niveaux a dessiner, la fonction retourne une valeur None
    # cela empêche la recursion de s'etendre a l'infini
    if depth == 0:
        return None

    # initialise la largeur de la branche courante
    turtle.width(branch_width)
    # dessine la branche courante
    turtle.forward(branch_length)

    # rotate le crayon a droite d'un certain angle
    # cela prepare la branche enfant de droite (appel recursif)
    turtle.right(angle)

    # appel recursif pour dessiner la branche enfant de droite
    # la branche enfant est :
    #   - plus courte (branch_length * ratio)
    #   - plus fine (branch_width * ratio)
    #   - un niveau de profondeur en dessous (depth - 1)
    # comme nous avons tourne a droite avant cet appel
    # la branche enfant est inclinée par rapport au parent
    fractal_canopy(turtle, branch_length * ratio, branch_width * ratio, ratio, depth - 1, angle)

    # rotate le crayon a droite d'un certain angle en passant par la position de depart (2 * angle)
    # cela prepare la branche enfant de gauche (appel recursif)
    turtle.left(angle * 2)

    # appel recursif pour dessiner la branche enfant de gauche
    # la branche enfant est :
    #   - plus courte (branch_length * ratio)
    #   - plus fine (branch_width * ratio)
    #   - un niveau de profondeur en dessous (depth - 1)
    # comme nous avons tourne a gauche avant cet appel
    # la branche enfant est inclinée par rapport au parent
    fractal_canopy(turtle, branch_length * ratio, branch_width * ratio, ratio, depth - 1, angle)

    # rotate le crayon a droite pour retourner a l'angle de la branche parente
    turtle.right(angle)

    # retour a la branche parente
    turtle.backward(branch_length)


def main():
    screen = initialize_screen(width=1.0, height=1.0)
    turtle = initialize_turtle(speed=1)

    # rotate de 90° pour dessiner l'arbre vers le haut de la fenetre
    turtle.left(90)
    # choix de la couleur de dessin
    turtle.color("black")
    # dessin
    fractal_canopy(turtle, branch_length=70, branch_width=5, ratio=0.75, depth=8, angle=33)

    screen.mainloop()


if __name__ == "__main__":
    main()
```

Pour plus de détails sur l'exécution de la fonction voir ce [pdf](./assets/08/explanation_fractal_canopy.pdf) d'explications.
